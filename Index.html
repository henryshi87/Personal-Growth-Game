<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Personal Growth Radar (Life-as-a-Game)</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121a33; --panel2:#0f1730; --text:#e8ecff; --muted:#aab3da;
      --accent:#6aa6ff; --good:#34d399; --warn:#fbbf24; --bad:#fb7185;
      --border:rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#070b17, #0b1020 60%, #070b17); color:var(--text);}
    a{color:var(--accent)}
    header{padding:18px 18px 10px; max-width:1180px; margin:0 auto;}
    header h1{margin:0 0 6px; font-size:20px; font-weight:700;}
    header p{margin:0; color:var(--muted); font-size:13px; line-height:1.4}
    main{display:grid; gap:12px; padding:12px 18px 22px; max-width:1180px; margin:0 auto; grid-template-columns: 420px 1fr;}
    @media (max-width: 980px){ main{grid-template-columns:1fr;} }
    .card{background:linear-gradient(180deg,var(--panel), var(--panel2)); border:1px solid var(--border); border-radius:14px; padding:14px;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row > *{flex:0 0 auto}
    .grow{flex:1 1 auto}
    label{font-size:12px; color:var(--muted)}
    input[type="number"], input[type="text"]{
      background:#0a1025; border:1px solid var(--border); color:var(--text);
      border-radius:10px; padding:9px 10px; outline:none;
    }
    input[type="number"]{width:86px}
    input[type="text"]{width:240px}
    button{
      background:#0a1025; border:1px solid var(--border); color:var(--text);
      border-radius:10px; padding:9px 10px; cursor:pointer;
    }
    button.primary{background:rgba(106,166,255,.15); border-color:rgba(106,166,255,.35)}
    button.danger{background:rgba(251,113,133,.15); border-color:rgba(251,113,133,.35)}
    button:active{transform:translateY(1px)}
    .hint{color:var(--muted); font-size:12px; line-height:1.4}
    .kpi{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin-top:10px;}
    .kpi .mini{background:#0a1025; border:1px solid var(--border); border-radius:12px; padding:10px;}
    .mini .v{font-weight:750; font-size:16px;}
    .mini .t{color:var(--muted); font-size:12px;}
    table{width:100%; border-collapse:collapse; font-size:12px;}
    th, td{border-bottom:1px solid rgba(255,255,255,.07); padding:8px 6px; vertical-align:middle}
    th{color:var(--muted); font-weight:650; text-align:left; position:sticky; top:0; background:rgba(18,26,51,.9); backdrop-filter: blur(6px);}
    .scroll{max-height:460px; overflow:auto; border:1px solid rgba(255,255,255,.07); border-radius:12px;}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#0a1025; font-size:12px;}
    .dot{width:8px; height:8px; border-radius:999px; background:var(--accent); display:inline-block}
    .dot.good{background:var(--good)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--bad)}
    .split{display:grid; grid-template-columns: 1fr 1fr; gap:12px;}
    @media (max-width: 980px){ .split{grid-template-columns:1fr;} }
    .skillList{display:flex; flex-direction:column; gap:8px; margin-top:8px;}
    .skillItem{display:flex; gap:8px; align-items:center;}
    .skillItem input{flex:1 1 auto; width:auto}
    .skillItem .handle{color:var(--muted); font-size:14px; width:18px; text-align:center}
    .footer{color:var(--muted); font-size:12px; padding-top:10px}
    .svgwrap{display:flex; justify-content:center; align-items:center;}
    .legend{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .legend .pill{cursor:default}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
    .small{font-size:11px}
  </style>
</head>
<body>
<header>
  <h1>Personal Growth Radar</h1>
  <p>Track daily XP (0–3 per skill), compute rolling 30‑day levels (0–10), and visualize your current “build” as a radar chart. Data stays on your device (localStorage). Export/import supported.</p>
</header>

<main>
  <section class="card" id="left">
    <div class="row">
      <div class="grow">
        <label>Rolling window (days)</label><br/>
        <input id="windowDays" type="number" min="7" max="120" step="1" value="30"/>
      </div>
      <div class="grow">
        <label>Target XP for Level 10 (per window)</label><br/>
        <input id="targetXP" type="number" min="10" max="300" step="1" value="60"/>
      </div>
    </div>

    <div style="height:10px"></div>

    <div class="row">
      <button class="primary" id="addSkillBtn">Add skill</button>
      <button id="resetTodayBtn">Reset today</button>
      <button class="danger" id="wipeAllBtn">Wipe all data</button>
    </div>

    <div class="hint" style="margin-top:10px">
      Scoring suggestion: <span class="mono">+1</span> small learning, <span class="mono">+2</span> meaningful practice, <span class="mono">+3</span> shipped/applied. Daily cap per skill: 3.
    </div>

    <div class="skillList" id="skillList"></div>

    <div style="height:10px"></div>

    <div class="row">
      <button id="exportBtn">Export JSON</button>
      <button id="importBtn">Import JSON</button>
      <input type="file" id="importFile" accept="application/json" style="display:none"/>
    </div>

    <div class="footer">
      Tip: Keep 8–12 skills. Use weekly review: push one skill, maintain one, ignore the rest guilt‑free.
    </div>
  </section>

  <section class="card" id="right">
    <div class="split">
      <div class="card" style="padding:12px;">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="pill"><span class="dot"></span><span>Current build (levels 0–10)</span></div>
          </div>
          <div class="pill"><span class="dot good"></span><span id="asOf"></span></div>
        </div>

        <div class="svgwrap" style="margin-top:10px">
          <svg id="radarSvg" width="360" height="360" viewBox="0 0 360 360" role="img" aria-label="Radar chart"></svg>
        </div>

        <div class="legend" id="legend"></div>

        <div class="kpi" id="kpis"></div>
      </div>

      <div class="card" style="padding:12px;">
        <div class="row" style="justify-content:space-between">
          <div class="pill"><span class="dot warn"></span><span>Daily Log</span></div>
          <div class="hint">Enter 0–3 points. Rolling window updates automatically.</div>
        </div>

        <div class="scroll" style="margin-top:10px">
          <table id="logTable"></table>
        </div>
      </div>
    </div>
  </section>
</main>

<script>
(function(){
  const STORAGE_KEY = "pg_radar_v1";

  const defaults = {
    windowDays: 30,
    targetXP: 60,
    skills: [
      {id: uid(), name: "Health & Fitness"},
      {id: uid(), name: "Sleep & Recovery"},
      {id: uid(), name: "English / Communication"},
      {id: uid(), name: "Deep Work / Focus"},
      {id: uid(), name: "Career / Research Output"},
      {id: uid(), name: "Learning / Study"},
      {id: uid(), name: "Relationships / Family"},
      {id: uid(), name: "Finance / Life Admin"},
      {id: uid(), name: "Mindset / Emotional Regulation"},
      {id: uid(), name: "Fun / Curiosity"}
    ],
    // log[date][skillId] = points
    log: {}
  };

  function uid(){
    return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
  }

  function todayStr(d=new Date()){
    const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    const yyyy = x.getFullYear();
    const mm = String(x.getMonth()+1).padStart(2,'0');
    const dd = String(x.getDate()).padStart(2,'0');
    return `${yyyy}-${mm}-${dd}`;
  }

  function addDays(dateStr, delta){
    const [y,m,d] = dateStr.split("-").map(Number);
    const dt = new Date(y, m-1, d);
    dt.setDate(dt.getDate()+delta);
    return todayStr(dt);
  }

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return structuredClone(defaults);
      const parsed = JSON.parse(raw);
      // basic migration / validation
      if(!parsed.skills || !parsed.log) return structuredClone(defaults);
      return Object.assign(structuredClone(defaults), parsed);
    }catch(e){
      return structuredClone(defaults);
    }
  }

  function save(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function structuredClone(obj){
    return JSON.parse(JSON.stringify(obj));
  }

  let state = load();

  const el = {
    windowDays: document.getElementById("windowDays"),
    targetXP: document.getElementById("targetXP"),
    skillList: document.getElementById("skillList"),
    addSkillBtn: document.getElementById("addSkillBtn"),
    resetTodayBtn: document.getElementById("resetTodayBtn"),
    wipeAllBtn: document.getElementById("wipeAllBtn"),
    exportBtn: document.getElementById("exportBtn"),
    importBtn: document.getElementById("importBtn"),
    importFile: document.getElementById("importFile"),
    radarSvg: document.getElementById("radarSvg"),
    logTable: document.getElementById("logTable"),
    legend: document.getElementById("legend"),
    kpis: document.getElementById("kpis"),
    asOf: document.getElementById("asOf")
  };

  // --- Computations ---
  function getWindowDates(){
    const n = clampInt(state.windowDays, 7, 120);
    const end = todayStr();
    const dates = [];
    for(let i=n-1; i>=0; i--){
      dates.push(addDays(end, -i));
    }
    return dates;
  }

  function clampInt(v, min, max){
    v = parseInt(v, 10);
    if(Number.isNaN(v)) v = min;
    return Math.max(min, Math.min(max, v));
  }

  function pointsFor(date, skillId){
    return (state.log[date] && Number(state.log[date][skillId])) || 0;
  }

  function setPoints(date, skillId, pts){
    pts = clampInt(pts, 0, 3);
    if(!state.log[date]) state.log[date] = {};
    state.log[date][skillId] = pts;
    // cleanup zeros to keep storage light
    if(pts === 0){
      delete state.log[date][skillId];
      if(Object.keys(state.log[date]).length === 0) delete state.log[date];
    }
    save();
    renderAll();
  }

  function xpInWindow(skillId){
    const dates = getWindowDates();
    let sum = 0;
    for(const d of dates) sum += pointsFor(d, skillId);
    return sum;
  }

  function levelFromXP(xp){
    const target = clampInt(state.targetXP, 10, 300);
    const lvl = Math.round(10 * (xp / target));
    return Math.max(0, Math.min(10, lvl));
  }

  function dailyQuestCompletion(date){
    // Daily quest: >=1 point in any 3 skills
    let count = 0;
    for(const s of state.skills){
      if(pointsFor(date, s.id) >= 1) count++;
    }
    return count >= 3;
  }

  function mainQuestCompletion(date){
    // Main quest: >=2 points in the "priority skill" (lowest level in window)
    const priority = lowestLevelSkill();
    if(!priority) return false;
    return pointsFor(date, priority.id) >= 2;
  }

  function lowestLevelSkill(){
    let best = null;
    for(const s of state.skills){
      const xp = xpInWindow(s.id);
      const lvl = levelFromXP(xp);
      if(!best || lvl < best.lvl || (lvl === best.lvl && xp < best.xp)){
        best = {id:s.id, name:s.name, lvl, xp};
      }
    }
    return best;
  }

  function streakDailyQuest(){
    // streak up to today, contiguous
    const dates = getWindowDates().slice().reverse(); // today backward
    let streak = 0;
    for(const d of dates){
      if(dailyQuestCompletion(d)) streak++;
      else break;
    }
    return streak;
  }

  // --- Rendering ---
  function renderSettings(){
    el.windowDays.value = clampInt(state.windowDays, 7, 120);
    el.targetXP.value = clampInt(state.targetXP, 10, 300);
    el.asOf.textContent = "As of " + todayStr();
  }

  function renderSkills(){
    el.skillList.innerHTML = "";
    state.skills.forEach((s, idx) => {
      const row = document.createElement("div");
      row.className = "skillItem";
      const handle = document.createElement("div");
      handle.className = "handle";
      handle.title = "Reorder using arrows";
      handle.textContent = "≡";

      const input = document.createElement("input");
      input.type = "text";
      input.value = s.name;
      input.addEventListener("change", () => {
        s.name = input.value.trim() || s.name;
        save(); renderAll();
      });

      const up = document.createElement("button");
      up.textContent = "↑";
      up.title = "Move up";
      up.addEventListener("click", () => {
        if(idx === 0) return;
        const tmp = state.skills[idx-1];
        state.skills[idx-1] = state.skills[idx];
        state.skills[idx] = tmp;
        save(); renderAll();
      });

      const down = document.createElement("button");
      down.textContent = "↓";
      down.title = "Move down";
      down.addEventListener("click", () => {
        if(idx === state.skills.length-1) return;
        const tmp = state.skills[idx+1];
        state.skills[idx+1] = state.skills[idx];
        state.skills[idx] = tmp;
        save(); renderAll();
      });

      const del = document.createElement("button");
      del.className = "danger";
      del.textContent = "✕";
      del.title = "Delete skill";
      del.addEventListener("click", () => {
        if(state.skills.length <= 3){
          alert("Keep at least 3 skills for the radar chart.");
          return;
        }
        if(!confirm(`Delete skill "${s.name}"? (Data stays in log but will no longer display.)`)) return;
        state.skills = state.skills.filter(x => x.id !== s.id);
        save(); renderAll();
      });

      row.append(handle, input, up, down, del);
      el.skillList.appendChild(row);
    });
  }

  function renderLogTable(){
    const dates = getWindowDates().slice().reverse(); // today first
    const skills = state.skills;

    const thead = document.createElement("thead");
    const trh = document.createElement("tr");
    const th0 = document.createElement("th"); th0.textContent = "Date";
    trh.appendChild(th0);
    for(const s of skills){
      const th = document.createElement("th");
      th.textContent = shortName(s.name);
      th.title = s.name;
      trh.appendChild(th);
    }
    const thQ = document.createElement("th"); thQ.textContent = "Daily Quest";
    trh.appendChild(thQ);
    thead.appendChild(trh);

    const tbody = document.createElement("tbody");
    for(const d of dates){
      const tr = document.createElement("tr");
      const tdDate = document.createElement("td");
      tdDate.textContent = d;
      tdDate.className = "mono small";
      tr.appendChild(tdDate);

      for(const s of skills){
        const td = document.createElement("td");
        const inp = document.createElement("input");
        inp.type = "number";
        inp.min = 0; inp.max = 3; inp.step = 1;
        inp.value = pointsFor(d, s.id);
        inp.addEventListener("change", () => setPoints(d, s.id, inp.value));
        td.appendChild(inp);
        tr.appendChild(td);
      }

      const tdQuest = document.createElement("td");
      const ok = dailyQuestCompletion(d);
      tdQuest.innerHTML = ok
        ? `<span class="pill"><span class="dot good"></span><span>Done</span></span>`
        : `<span class="pill"><span class="dot bad"></span><span>—</span></span>`;
      tr.appendChild(tdQuest);

      tbody.appendChild(tr);
    }

    el.logTable.innerHTML = "";
    el.logTable.appendChild(thead);
    el.logTable.appendChild(tbody);
  }

  function shortName(name){
    // compact header
    const max = 12;
    name = name.replace(/\s+/g,' ').trim();
    if(name.length <= max) return name;
    return name.slice(0, max-1) + "…";
  }

  function renderKPIs(){
    const dates = getWindowDates();
    const today = todayStr();
    const priority = lowestLevelSkill();
    const streak = streakDailyQuest();

    // total XP today
    let xpToday = 0;
    for(const s of state.skills) xpToday += pointsFor(today, s.id);

    // average level
    let sumLvl = 0;
    for(const s of state.skills) sumLvl += levelFromXP(xpInWindow(s.id));
    const avgLvl = state.skills.length ? (sumLvl / state.skills.length) : 0;

    // weakest skill
    const weak = priority ? `${priority.name} (L${priority.lvl})` : "—";

    // main quest status
    const mainOk = mainQuestCompletion(today);

    el.kpis.innerHTML = "";
    const items = [
      {v: xpToday, t: "XP today (all skills)"},
      {v: avgLvl.toFixed(1), t: "Avg level (window)"},
      {v: streak, t: "Daily quest streak"},
      {v: weak, t: "Lowest skill (priority)"},
      {v: mainOk ? "Done" : "—", t: "Main quest today"},
      {v: dates.length + "d", t: "Window"}
    ];
    for(const it of items){
      const d = document.createElement("div");
      d.className = "mini";
      d.innerHTML = `<div class="v">${escapeHtml(String(it.v))}</div><div class="t">${escapeHtml(it.t)}</div>`;
      el.kpis.appendChild(d);
    }
  }

  function renderLegend(){
    el.legend.innerHTML = "";
    for(const s of state.skills){
      const xp = xpInWindow(s.id);
      const lvl = levelFromXP(xp);
      const pill = document.createElement("div");
      pill.className = "pill";
      pill.title = `${s.name}: XP=${xp}, Level=${lvl}/10`;
      pill.innerHTML = `<span class="dot"></span><span>${escapeHtml(s.name)}: <span class="mono">L${lvl}</span></span>`;
      el.legend.appendChild(pill);
    }
  }

  function escapeHtml(str){
    return str.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  }

  // --- Radar Chart (SVG) ---
  function renderRadar(){
    const svg = el.radarSvg;
    svg.innerHTML = "";

    const skills = state.skills;
    const n = skills.length;
    if(n < 3){
      svg.innerHTML = `<text x="180" y="180" text-anchor="middle" fill="white" font-size="12">Add at least 3 skills</text>`;
      return;
    }

    const cx = 180, cy = 180;
    const R = 140;
    const rings = 5;

    // background rings
    for(let i=1;i<=rings;i++){
      const r = (R * i / rings);
      const poly = polygonPoints(n, cx, cy, r, -Math.PI/2, Array(n).fill(10), 10);
      svg.appendChild(svgEl("polygon", {points: poly, fill:"none", stroke:"rgba(255,255,255,.10)", "stroke-width":"1"}));
      // ring label
      const lvl = Math.round(10 * i / rings);
      svg.appendChild(svgEl("text", {x: cx + 6, y: cy - r + 12, fill:"rgba(255,255,255,.35)", "font-size":"10"}, String(lvl)));
    }

    // axes + labels
    for(let i=0;i<n;i++){
      const angle = -Math.PI/2 + i * (2*Math.PI/n);
      const x = cx + R*Math.cos(angle);
      const y = cy + R*Math.sin(angle);
      svg.appendChild(svgEl("line", {x1:cx,y1:cy,x2:x,y2:y, stroke:"rgba(255,255,255,.12)", "stroke-width":"1"}));

      // labels slightly outside
      const lx = cx + (R+16)*Math.cos(angle);
      const ly = cy + (R+16)*Math.sin(angle);
      const anchor = (Math.cos(angle) > 0.25) ? "start" : (Math.cos(angle) < -0.25 ? "end" : "middle");
      const label = shortName(skills[i].name);
      svg.appendChild(svgEl("text", {x:lx,y:ly, fill:"rgba(232,236,255,.85)", "font-size":"10", "text-anchor":anchor}, label));
    }

    // data polygon
    const levels = skills.map(s => levelFromXP(xpInWindow(s.id)));
    const points = polygonPoints(n, cx, cy, R, -Math.PI/2, levels, 10);

    // fill
    svg.appendChild(svgEl("polygon", {points, fill:"rgba(106,166,255,.22)", stroke:"rgba(106,166,255,.7)", "stroke-width":"2"}));

    // markers
    const coords = polygonCoords(n, cx, cy, R, -Math.PI/2, levels, 10);
    for(const c of coords){
      svg.appendChild(svgEl("circle", {cx:c.x, cy:c.y, r:"3.2", fill:"rgba(232,236,255,.92)"}));
    }

    // center point
    svg.appendChild(svgEl("circle", {cx, cy, r:"2.4", fill:"rgba(255,255,255,.5)"}));
  }

  function polygonCoords(n, cx, cy, R, startAngle, levels, maxLevel){
    const out = [];
    for(let i=0;i<n;i++){
      const a = startAngle + i*(2*Math.PI/n);
      const r = R * (levels[i]/maxLevel);
      out.push({x: cx + r*Math.cos(a), y: cy + r*Math.sin(a)});
    }
    return out;
  }

  function polygonPoints(n, cx, cy, R, startAngle, levels, maxLevel){
    const coords = polygonCoords(n, cx, cy, R, startAngle, levels, maxLevel);
    return coords.map(p => `${p.x.toFixed(1)},${p.y.toFixed(1)}`).join(" ");
  }

  function svgEl(tag, attrs, text){
    const n = document.createElementNS("http://www.w3.org/2000/svg", tag);
    for(const [k,v] of Object.entries(attrs||{})) n.setAttribute(k, v);
    if(text != null) n.textContent = text;
    return n;
  }

  // --- Actions ---
  el.windowDays.addEventListener("change", () => {
    state.windowDays = clampInt(el.windowDays.value, 7, 120);
    save(); renderAll();
  });
  el.targetXP.addEventListener("change", () => {
    state.targetXP = clampInt(el.targetXP.value, 10, 300);
    save(); renderAll();
  });

  el.addSkillBtn.addEventListener("click", () => {
    const name = prompt("Skill name:");
    if(!name) return;
    state.skills.push({id: uid(), name: name.trim()});
    save(); renderAll();
  });

  el.resetTodayBtn.addEventListener("click", () => {
    const d = todayStr();
    if(!state.log[d]) return;
    if(!confirm("Reset all points for today?")) return;
    delete state.log[d];
    save(); renderAll();
  });

  el.wipeAllBtn.addEventListener("click", () => {
    if(!confirm("Wipe all data (skills, points, settings)?")) return;
    localStorage.removeItem(STORAGE_KEY);
    state = load();
    save(); renderAll();
  });

  el.exportBtn.addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "personal_growth_radar_export.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  el.importBtn.addEventListener("click", () => el.importFile.click());

  el.importFile.addEventListener("change", async (e) => {
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    try{
      const text = await f.text();
      const parsed = JSON.parse(text);
      if(!parsed.skills || !parsed.log) throw new Error("Invalid file format.");
      // keep only safe fields
      state.windowDays = clampInt(parsed.windowDays ?? defaults.windowDays, 7, 120);
      state.targetXP = clampInt(parsed.targetXP ?? defaults.targetXP, 10, 300);
      state.skills = Array.isArray(parsed.skills) ? parsed.skills.filter(x => x && x.id && x.name) : structuredClone(defaults.skills);
      state.log = parsed.log && typeof parsed.log === "object" ? parsed.log : {};
      save(); renderAll();
      alert("Imported successfully.");
    }catch(err){
      alert("Import failed: " + err.message);
    }finally{
      el.importFile.value = "";
    }
  });

  function renderAll(){
    renderSettings();
    renderSkills();
    renderLogTable();
    renderRadar();
    renderLegend();
    renderKPIs();
  }

  // first paint
  renderAll();

})();
</script>
</body>
</html>
